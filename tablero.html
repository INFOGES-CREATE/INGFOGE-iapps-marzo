<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tablero Poblacional Curicó - Sistema Avanzado de Análisis Demográfico</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #1a73e8;
            --secondary-color: #4285f4;
            --accent-color: #fbbc04;
            --danger-color: #ea4335;
            --success-color: #34a853;
            --light-gray: #f5f5f5;
            --medium-gray: #e0e0e0;
            --dark-gray: #757575;
            --text-color: #212121;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --transition: all 0.3s ease;
            --border-radius: 8px;
            --chart-height: 300px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            color: var(--text-color);
            background-color: #f9fafb;
            line-height: 1.6;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-md);
            position: relative;
            z-index: 10;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            margin-right: 12px;
        }

        .logo-icon {
            margin-right: 10px;
            font-size: 2.2rem;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 500px;
        }

        .user-controls {
            display: flex;
            align-items: center;
        }

        .control-btn {
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            margin-left: 12px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
        }

        .control-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .control-btn i {
            margin-right: 6px;
        }

        /* Main Container Styles */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Dashboard Layout */
        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        /* Sidebar Styles */
        .sidebar {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            padding: 1.5rem;
            height: calc(100vh - 180px);
            position: sticky;
            top: 100px;
            overflow-y: auto;
        }

        .filter-section {
            margin-bottom: 1.5rem;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .filter-title i {
            margin-right: 8px;
        }

        .filter-content {
            margin-bottom: 1rem;
        }

        select, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            font-family: var(--font-main);
            margin-bottom: 8px;
            transition: var(--transition);
        }

        select:focus, input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            margin-right: 10px;
        }

        .checkbox-item input {
            margin-right: 5px;
        }

        .range-filter {
            margin-bottom: 15px;
        }

        .range-values {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.85rem;
            color: var(--dark-gray);
        }

        .apply-filters-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            transition: var(--transition);
            margin-top: 15px;
        }

        .apply-filters-btn:hover {
            background-color: var(--secondary-color);
        }

        .reset-filters {
            text-align: center;
            margin-top: 10px;
            color: var(--dark-gray);
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .reset-filters:hover {
            color: var(--danger-color);
        }

        /* Main Content Styles */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Stats Cards */
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
        }

        .stat-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            padding: 1.2rem;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-title {
            font-weight: 500;
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        .stat-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .icon-primary {
            background-color: rgba(26, 115, 232, 0.1);
            color: var(--primary-color);
        }

        .icon-success {
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--success-color);
        }

        .icon-warning {
            background-color: rgba(251, 188, 4, 0.1);
            color: var(--accent-color);
        }

        .icon-danger {
            background-color: rgba(234, 67, 53, 0.1);
            color: var(--danger-color);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-description {
            font-size: 0.8rem;
            color: var(--dark-gray);
            display: flex;
            align-items: center;
        }

        .trend-up {
            color: var(--success-color);
            margin-right: 4px;
        }

        .trend-down {
            color: var(--danger-color);
            margin-right: 4px;
        }

        /* Chart Sections */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 1200px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            padding: 1.2rem;
            height: 100%;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-weight: 600;
            color: var(--text-color);
        }

        .chart-actions {
            display: flex;
            gap: 8px;
        }

        .chart-btn {
            background-color: var(--light-gray);
            border: none;
            padding: 5px 8px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            font-size: 0.8rem;
        }

        .chart-btn:hover {
            background-color: var(--medium-gray);
        }

        .chart-btn i {
            margin-right: 4px;
        }

        .chart-content {
            position: relative;
            height: var(--chart-height);
            width: 100%;
        }

        .map-container {
            height: 500px;
        }

        .fullwidth {
            grid-column: 1 / -1;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            padding: 1.2rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th, .data-table td {
            padding: 10px 15px;
            text-align: left;
            border-bottom: 1px solid var(--medium-gray);
        }

        .data-table th {
            background-color: var(--light-gray);
            font-weight: 600;
            color: var(--primary-color);
        }

        .data-table tbody tr:hover {
            background-color: var(--light-gray);
        }

        .data-table .center {
            text-align: center;
        }

        .data-table .right {
            text-align: right;
        }

        /* Footer Styles */
        .footer {
            text-align: center;
            padding: 1.5rem;
            background-color: white;
            margin-top: 2rem;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            box-shadow: var(--shadow-sm);
        }

        .footer-text {
            color: var(--dark-gray);
            font-size: 0.85rem;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .sidebar {
                height: auto;
                position: static;
                margin-bottom: 1.5rem;
            }

            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .user-controls {
                margin-top: 1rem;
            }
        }

        @media (max-width: 768px) {
            .stats-overview {
                grid-template-columns: 1fr 1fr;
            }

            .control-btn span {
                display: none;
            }

            .control-btn i {
                margin-right: 0;
            }
        }

        @media (max-width: 480px) {
            .stats-overview {
                grid-template-columns: 1fr;
            }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: var(--transition);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1.2rem;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-weight: 600;
            font-size: 1.2rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--dark-gray);
        }

        .modal-body {
            padding: 1.2rem;
        }

        .modal-footer {
            padding: 1.2rem;
            border-top: 1px solid var(--medium-gray);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-btn {
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-secondary {
            background-color: var(--light-gray);
            border: 1px solid var(--medium-gray);
            color: var(--text-color);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border: 1px solid var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: var(--medium-gray);
        }

        /* Loading Indicator */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--light-gray);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        .loading-text {
            color: var(--primary-color);
            font-weight: 600;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tooltips */
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }

        /* Additional Chart Styles */
        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 5px;
        }

        /* Tabs Styles */
        .tabs-container {
            margin-bottom: 1rem;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--medium-gray);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
            font-weight: 500;
        }

        .tab.active {
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .tab:hover:not(.active) {
            background-color: var(--light-gray);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Custom Select with Search */
        .custom-select-container {
            position: relative;
            width: 100%;
        }

        .custom-select-selected {
            padding: 8px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .custom-select-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--medium-gray);
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
            box-shadow: var(--shadow-md);
        }

        .custom-select-search {
            padding: 8px;
            position: sticky;
            top: 0;
            background: white;
            border-bottom: 1px solid var(--medium-gray);
        }

        .custom-select-search input {
            width: 100%;
            padding: 5px 8px;
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
        }

        .custom-select-option {
            padding: 8px 12px;
            cursor: pointer;
        }

        .custom-select-option:hover {
            background-color: var(--light-gray);
        }

        .custom-select-option.selected {
            background-color: rgba(26, 115, 232, 0.1);
            color: var(--primary-color);
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #323232;
            color: white;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            z-index: 1000;
            display: flex;
            align-items: center;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification-icon {
            margin-right: 12px;
            font-size: 1.2rem;
        }

        .notification-message {
            font-size: 0.9rem;
        }

        /* Custom toggle switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 46px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--medium-gray);
            transition: var(--transition);
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        /* Card styles for reports */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .report-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            padding: 1.2rem;
            transition: var(--transition);
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .report-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .report-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .report-title {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .report-description {
            font-size: 0.85rem;
            color: var(--dark-gray);
            flex-grow: 1;
            margin-bottom: 15px;
        }

        .report-actions {
            display: flex;
            justify-content: flex-end;
        }

        .report-btn {
            background-color: var(--light-gray);
            border: none;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
        }

        .report-btn:hover {
            background-color: var(--medium-gray);
        }

        /* Print styles */
        @media print {
            .header, .sidebar, .footer, .chart-actions, .modal-overlay {
                display: none !important;
            }

            .dashboard {
                display: block;
            }

            .main-content {
                width: 100%;
            }

            body {
                background-color: white;
            }

            .container {
                max-width: 100%;
                width: 100%;
                padding: 0;
            }

            .chart-container, .table-container, .stat-card {
                box-shadow: none;
                border: 1px solid #ddd;
                break-inside: avoid;
            }

            .chart-grid {
                display: block;
            }

            .chart-container {
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-container">
                <div class="logo"><i class="fas fa-chart-bar logo-icon"></i> Tablero Poblacional Curicó</div>
                <div class="subtitle">Sistema Avanzado de Análisis Demográfico para Gestión de Salud</div>
            </div>
            <div class="user-controls">
                <button class="control-btn" id="exportBtn">
                    <i class="fas fa-download"></i>
                    <span>Exportar</span>
                </button>
                <button class="control-btn" id="printBtn">
                    <i class="fas fa-print"></i>
                    <span>Imprimir</span>
                </button>
                <button class="control-btn" id="helpBtn">
                    <i class="fas fa-question-circle"></i>
                    <span>Ayuda</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Dashboard Layout -->
        <div class="dashboard">
            <!-- Sidebar with Filters -->
            <aside class="sidebar">
                <div class="filter-section">
                    <div class="filter-title">
                        <i class="fas fa-filter"></i> Filtros
                    </div>
                    <div class="filter-content">
                        <label for="yearFilter">Año:</label>
                        <select id="yearFilter">
                            <option value="2024" selected>2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                            <option value="2029">2029</option>
                            <option value="2030">2030</option>
                        </select>
                    </div>

                    <div class="filter-content">
                        <label for="communeFilter">Comuna:</label>
                        <select id="communeFilter">
                            <option value="curico" selected>Curicó</option>
                        </select>
                    </div>

                    <div class="filter-content">
                        <label for="centerFilter">Centro de Salud:</label>
                        <select id="centerFilter">
                            <option value="all" selected>Todos los centros</option>
                            <option value="central">CESFAM Curicó Centro</option>
                            <option value="maal">CESFAM Miguel Ángel Arenas López</option>
                            <option value="bma">CESFAM Betty Muñoz Arce</option>
                            <option value="colon">CESFAM Colón</option>
                            <option value="sarmiento">CESFAM Sarmiento</option>
                            <option value="niches">CESFAM Los Niches</option>
                        </select>
                    </div>

                    <div class="filter-content">
                        <label>Sexo:</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="maleFilter" checked>
                                <label for="maleFilter">Masculino</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="femaleFilter" checked>
                                <label for="femaleFilter">Femenino</label>
                            </div>
                        </div>
                    </div>

                    <div class="filter-content">
                        <label>Grupo Etario:</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="infantilFilter" checked>
                                <label for="infantilFilter">Infantil (0-9)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="adolescenteFilter" checked>
                                <label for="adolescenteFilter">Adolescente (10-19)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="adultoFilter" checked>
                                <label for="adultoFilter">Adulto (20-64)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="adultoMayorFilter" checked>
                                <label for="adultoMayorFilter">Adulto Mayor (≥65)</label>
                            </div>
                        </div>
                    </div>

                    <div class="filter-content">
                        <label for="ageRangeFilter">Rango de Edad:</label>
                        <div class="range-filter">
                            <input type="range" id="ageRangeMin" min="0" max="99" value="0">
                            <input type="range" id="ageRangeMax" min="0" max="99" value="99">
                            <div class="range-values">
                                <span id="ageRangeMinValue">0</span>
                                <span id="ageRangeMaxValue">99</span>
                            </div>
                        </div>
                    </div>

                    <button class="apply-filters-btn" id="applyFilters">
                        Aplicar Filtros
                    </button>
                    <div class="reset-filters" id="resetFilters">
                        Restablecer Filtros
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-title">
                        <i class="fas fa-file-alt"></i> Informes Predefinidos
                    </div>
                    <div class="filter-content">
                        <select id="reportTemplate">
                            <option value="" selected>Seleccionar Informe</option>
                            <option value="report_distribution">Distribución por Centro de Salud</option>
                            <option value="report_age_gender">Distribución por Edad y Sexo</option>
                            <option value="report_comparison">Comparación Inscrita vs. INE</option>
                            <option value="report_trends">Tendencias Poblacionales</option>
                            <option value="report_geo">Geolocalización y Cobertura</option>
                            <option value="report_full">Informe Completo</option>
                        </select>
                        <button class="apply-filters-btn" id="generateReport">
                            Generar Informe
                        </button>
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-title">
                        <i class="fas fa-cog"></i> Configuración
                    </div>
                    <div class="filter-content">
                        <div class="checkbox-item">
                            <input type="checkbox" id="darkModeToggle">
                            <label for="darkModeToggle">Modo Oscuro</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="autoRefreshToggle">
                            <label for="autoRefreshToggle">Actualización Automática</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="liveDataToggle">
                            <label for="liveDataToggle">Datos en Tiempo Real</label>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content">
                <!-- Stats Overview Cards -->
                <section class="stats-overview">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Población Total</div>
                            <div class="stat-icon icon-primary">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalPopulation">150,113</div>
                        <div class="stat-description">
                            <span class="trend-up"><i class="fas fa-arrow-up"></i> 2.3%</span> desde el año anterior
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Distribución por Sexo</div>
                            <div class="stat-icon icon-success">
                                <i class="fas fa-venus-mars"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="genderRatio">46.5% / 53.5%</div>
                        <div class="stat-description">
                            Masculino / Femenino
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Edad Promedio</div>
                            <div class="stat-icon icon-warning">
                                <i class="fas fa-birthday-cake"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="averageAge">38.2</div>
                        <div class="stat-description">
                            <span class="trend-up"><i class="fas fa-arrow-up"></i> 0.8</span> años desde 2023
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Población Pediátrica</div>
                            <div class="stat-icon icon-danger">
                                <i class="fas fa-child"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="pediatricPopulation">24.6%</div>
                        <div class="stat-description">
                            <span class="trend-down"><i class="fas fa-arrow-down"></i> 1.2%</span> desde el año anterior
                        </div>
                    </div>
                </section>

                <!-- Tab Container for different views -->
                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="overview">Vista General</div>
                        <div class="tab" data-tab="demographics">Demografía</div>
                        <div class="tab" data-tab="comparison">Comparativa</div>
                        <div class="tab" data-tab="geographical">Geográfico</div>
                        <div class="tab" data-tab="tables">Tablas</div>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="tab-content active" id="overview-tab">
                    <!-- Population Distribution by Health Center -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Distribución de Población por Centro de Salud</h3>
                            <div class="chart-actions">
                                <button class="chart-btn" id="downloadDistributionChart">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                                <button class="chart-btn" id="fullscreenDistributionChart">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>

                    <!-- Population Age Groups Chart Grid -->
                    <div class="chart-grid">
                        <!-- Population Pyramid -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Pirámide Poblacional</h3>
                                <div class="chart-actions">
                                    <button class="chart-btn" id="downloadPyramidChart">
                                        <i class="fas fa-download"></i> Exportar
                                    </button>
                                    <button class="chart-btn" id="fullscreenPyramidChart">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-content">
                                <canvas id="pyramidChart"></canvas>
                            </div>
                        </div>

                        <!-- Age Distribution Doughnut -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Distribución por Grupos Etarios</h3>
                                <div class="chart-actions">
                                    <button class="chart-btn" id="downloadAgeGroupsChart">
                                        <i class="fas fa-download"></i> Exportar
                                    </button>
                                    <button class="chart-btn" id="fullscreenAgeGroupsChart">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-content">
                                <canvas id="ageGroupsChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Historical Trends -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Tendencias Poblacionales (2020-2024)</h3>
                            <div class="chart-actions">
                                <button class="chart-btn" id="downloadTrendsChart">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                                <button class="chart-btn" id="fullscreenTrendsChart">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="trendsChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="demographics-tab">
                    <!-- Detailed Demographics Content -->
                    <div class="chart-grid">
                        <!-- Gender Distribution by Age -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Distribución por Sexo y Edad</h3>
                                <div class="chart-actions">
                                    <button class="chart-btn" id="downloadGenderAgeChart">
                                        <i class="fas fa-download"></i> Exportar
                                    </button>
                                    <button class="chart-btn" id="fullscreenGenderAgeChart">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-content">
                                <canvas id="genderAgeChart"></canvas>
                            </div>
                        </div>

                        <!-- Population by Center and Age Group -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Población por Centro y Grupo Etario</h3>
                                <div class="chart-actions">
                                    <button class="chart-btn" id="downloadCenterAgeChart">
                                        <i class="fas fa-download"></i> Exportar
                                    </button>
                                    <button class="chart-btn" id="fullscreenCenterAgeChart">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-content">
                                <canvas id="centerAgeChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Age Distribution -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Distribución Detallada por Edad</h3>
                            <div class="chart-actions">
                                <button class="chart-btn" id="downloadDetailedAgeChart">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                                <button class="chart-btn" id="fullscreenDetailedAgeChart">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="detailedAgeChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="comparison-tab">
                    <!-- INE vs Per Capita Comparison -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Comparativa Población INE vs. Inscrita</h3>
                            <div class="chart-actions">
                                <button class="chart-btn" id="downloadComparisonChart">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                                <button class="chart-btn" id="fullscreenComparisonChart">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-grid">
                        <!-- Cover Rate Chart -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Tasa de Cobertura por Grupo Etario</h3>
                                <div class="chart-actions">
                                    <button class="chart-btn" id="downloadCoverageChart">
                                        <i class="fas fa-download"></i> Exportar
                                    </button>
                                    <button class="chart-btn" id="fullscreenCoverageChart">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-content">
                                <canvas id="coverageChart"></canvas>
                            </div>
                        </div>

                        <!-- Gender Comparison INE vs Per Capita -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Comparativa de Sexo: INE vs. Inscrita</h3>
                                <div class="chart-actions">
                                    <button class="chart-btn" id="downloadGenderComparisonChart">
                                        <i class="fas fa-download"></i> Exportar
                                    </button>
                                    <button class="chart-btn" id="fullscreenGenderComparisonChart">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-content">
                                <canvas id="genderComparisonChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="geographical-tab">
                    <!-- Map Container -->
                    <div class="chart-container map-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Distribución Geográfica de Centros de Salud</h3>
                            <div class="chart-actions">
                                <button class="chart-btn" id="downloadMap">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                                <button class="chart-btn" id="fullscreenMap">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div id="mapChart" style="height: 100%;"></div>
                    </div>

                    <div class="chart-grid">
                        <!-- Density Chart -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Densidad Poblacional por Sector</h3>
                                <div class="chart-actions">
                                    <button class="chart-btn" id="downloadDensityChart">
                                        <i class="fas fa-download"></i> Exportar
                                    </button>
                                    <button class="chart-btn" id="fullscreenDensityChart">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-content">
                                <canvas id="densityChart"></canvas>
                            </div>
                        </div>

                        <!-- Service Area Coverage -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Cobertura por Área de Servicio</h3>
                                <div class="chart-actions">
                                    <button class="chart-btn" id="downloadServiceAreaChart">
                                        <i class="fas fa-download"></i> Exportar
                                    </button>
                                    <button class="chart-btn" id="fullscreenServiceAreaChart">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-content">
                                <canvas id="serviceAreaChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="tables-tab">
                    <!-- Population Data Table -->
                    <div class="table-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Datos Poblacionales por Centro de Salud</h3>
                            <div class="chart-actions">
                                <button class="chart-btn" id="downloadTable">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                                <button class="chart-btn" id="fullscreenTable">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <table class="data-table" id="populationTable">
                            <thead>
                                <tr>
                                    <th>Centro de Salud</th>
                                    <th class="center">Población Total</th>
                                    <th class="center">Masculino</th>
                                    <th class="center">Femenino</th>
                                    <th class="center">0-9 años</th>
                                    <th class="center">10-19 años</th>
                                    <th class="center">20-64 años</th>
                                    <th class="center">≥65 años</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>CESFAM Curicó Centro</td>
                                    <td class="center">41,532</td>
                                    <td class="center">18,111</td>
                                    <td class="center">23,421</td>
                                    <td class="center">3,878</td>
                                    <td class="center">5,444</td>
                                    <td class="center">25,601</td>
                                    <td class="center">6,609</td>
                                </tr>
                                <tr>
                                    <td>CESFAM Miguel Ángel Arenas López</td>
                                    <td class="center">28,763</td>
                                    <td class="center">14,094</td>
                                    <td class="center">14,669</td>
                                    <td class="center">3,199</td>
                                    <td class="center">3,687</td>
                                    <td class="center">18,218</td>
                                    <td class="center">3,659</td>
                                </tr>
                                <tr>
                                    <td>CESFAM Betty Muñoz Arce</td>
                                    <td class="center">28,461</td>
                                    <td class="center">12,604</td>
                                    <td class="center">15,857</td>
                                    <td class="center">3,782</td>
                                    <td class="center">4,039</td>
                                    <td class="center">16,868</td>
                                    <td class="center">3,772</td>
                                </tr>
                                <tr>
                                    <td>CESFAM Colón</td>
                                    <td class="center">23,785</td>
                                    <td class="center">11,115</td>
                                    <td class="center">12,670</td>
                                    <td class="center">2,858</td>
                                    <td class="center">3,281</td>
                                    <td class="center">14,315</td>
                                    <td class="center">3,331</td>
                                </tr>
                                <tr>
                                    <td>CESFAM Sarmiento</td>
                                    <td class="center">13,722</td>
                                    <td class="center">6,792</td>
                                    <td class="center">6,930</td>
                                    <td class="center">1,469</td>
                                    <td class="center">2,078</td>
                                    <td class="center">8,583</td>
                                    <td class="center">1,592</td>
                                </tr>
                                <tr>
                                    <td>CESFAM Los Niches</td>
                                    <td class="center">13,850</td>
                                    <td class="center">7,013</td>
                                    <td class="center">6,837</td>
                                    <td class="center">1,393</td>
                                    <td class="center">1,839</td>
                                    <td class="center">8,484</td>
                                    <td class="center">2,134</td>
                                </tr>
                                <tr>
                                    <td><strong>COMUNA CURICÓ</strong></td>
                                    <td class="center"><strong>150,113</strong></td>
                                    <td class="center"><strong>69,729</strong></td>
                                    <td class="center"><strong>80,384</strong></td>
                                    <td class="center"><strong>16,579</strong></td>
                                    <td class="center"><strong>20,368</strong></td>
                                    <td class="center"><strong>92,069</strong></td>
                                    <td class="center"><strong>21,097</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Age Group Detailed Table -->
                    <div class="table-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Desglose Detallado por Grupos de Edad</h3>
                            <div class="chart-actions">
                                <button class="chart-btn" id="downloadAgeTable">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                                <button class="chart-btn" id="fullscreenAgeTable">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <table class="data-table" id="ageGroupTable">
                            <thead>
                                <tr>
                                    <th>Centro de Salud</th>
                                    <th class="center">0-4 años</th>
                                    <th class="center">5-9 años</th>
                                    <th class="center">10-14 años</th>
                                    <th class="center">15-19 años</th>
                                    <th class="center">20-44 años</th>
                                    <th class="center">45-64 años</th>
                                    <th class="center">65-79 años</th>
                                    <th class="center">≥80 años</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>CESFAM Curicó Centro</td>
                                    <td class="center">1,518</td>
                                    <td class="center">2,360</td>
                                    <td class="center">2,671</td>
                                    <td class="center">2,773</td>
                                    <td class="center">14,678</td>
                                    <td class="center">10,923</td>
                                    <td class="center">5,071</td>
                                    <td class="center">1,538</td>
                                </tr>
                                <tr>
                                    <td>CESFAM Miguel Ángel Arenas López</td>
                                    <td class="center">1,466</td>
                                    <td class="center">1,733</td>
                                    <td class="center">1,941</td>
                                    <td class="center">1,746</td>
                                    <td class="center">10,846</td>
                                    <td class="center">7,372</td>
                                    <td class="center">2,955</td>
                                    <td class="center">704</td>
                                </tr>
                                <tr>
                                    <td>CESFAM Betty Muñoz Arce</td>
                                    <td class="center">1,664</td>
                                    <td class="center">2,118</td>
                                    <td class="center">2,148</td>
                                    <td class="center">1,891</td>
                                    <td class="center">10,166</td>
                                    <td class="center">6,702</td>
                                    <td class="center">2,934</td>
                                    <td class="center">838</td>
                                </tr>
                                <tr>
                                    <td>CESFAM Colón</td>
                                    <td class="center">1,192</td>
                                    <td class="center">1,666</td>
                                    <td class="center">1,702</td>
                                    <td class="center">1,579</td>
                                    <td class="center">8,648</td>
                                    <td class="center">5,667</td>
                                    <td class="center">2,659</td>
                                    <td class="center">672</td>
                                </tr>
                                <tr>
                                    <td>CESFAM Sarmiento</td>
                                    <td class="center">599</td>
                                    <td class="center">870</td>
                                    <td class="center">1,016</td>
                                    <td class="center">1,062</td>
                                    <td class="center">5,107</td>
                                    <td class="center">3,476</td>
                                    <td class="center">1,272</td>
                                    <td class="center">320</td>
                                </tr>
                                <tr>
                                    <td>CESFAM Los Niches</td>
                                    <td class="center">589</td>
                                    <td class="center">804</td>
                                    <td class="center">934</td>
                                    <td class="center">905</td>
                                    <td class="center">4,797</td>
                                    <td class="center">3,687</td>
                                    <td class="center">1,674</td>
                                    <td class="center">460</td>
                                </tr>
                                <tr>
                                    <td><strong>COMUNA CURICÓ</strong></td>
                                    <td class="center"><strong>7,028</strong></td>
                                    <td class="center"><strong>9,551</strong></td>
                                    <td class="center"><strong>10,412</strong></td>
                                    <td class="center"><strong>9,956</strong></td>
                                    <td class="center"><strong>54,242</strong></td>
                                    <td class="center"><strong>37,827</strong></td>
                                    <td class="center"><strong>16,565</strong></td>
                                    <td class="center"><strong>4,532</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-text">
            Tablero Poblacional Curicó © 2024-2025 | Desarrollado por Sistema de Salud Municipal | Datos actualizados al: Septiembre 2024
        </div>
    </footer>

    <!-- Modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Exportar Datos</h3>
                <button class="modal-close" id="closeExportModal">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Formato de Exportación</h4>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="radio" id="exportExcel" name="exportFormat" value="excel" checked>
                        <label for="exportExcel">Excel (.xlsx)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="radio" id="exportPDF" name="exportFormat" value="pdf">
                        <label for="exportPDF">PDF (.pdf)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="radio" id="exportCSV" name="exportFormat" value="csv">
                        <label for="exportCSV">CSV (.csv)</label>
                    </div>
                </div>

                <h4>Contenido a Exportar</h4>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="exportData" checked>
                        <label for="exportData">Datos tabulares</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="exportCharts" checked>
                        <label for="exportCharts">Gráficos</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="exportSummary" checked>
                        <label for="exportSummary">Resumen estadístico</label>
                    </div>
                </div>

                <h4>Filtros Aplicados</h4>
                <p>Los filtros actuales se aplicarán a la exportación:</p>
                <ul id="exportFiltersList">
                    <li>Año: 2024</li>
                    <li>Comuna: Curicó</li>
                    <li>Centro de Salud: Todos</li>
                    <li>Sexo: Ambos</li>
                    <li>Grupo Etario: Todos</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-secondary" id="cancelExport">Cancelar</button>
                <button class="modal-btn btn-primary" id="confirmExport">Exportar</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="helpModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Ayuda del Tablero Poblacional</h3>
                <button class="modal-close" id="closeHelpModal">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Navegación</h4>
                <p>El Tablero Poblacional Curicó está organizado en pestañas que muestran diferentes aspectos de los datos demográficos:</p>
                <ul>
                    <li><strong>Vista General:</strong> Resumen de los indicadores clave y distribución de la población.</li>
                    <li><strong>Demografía:</strong> Análisis detallado por edad y sexo.</li>
                    <li><strong>Comparativa:</strong> Contraste entre datos INE y población inscrita.</li>
                    <li><strong>Geográfico:</strong> Distribución espacial y áreas de cobertura.</li>
                    <li><strong>Tablas:</strong> Datos tabulares detallados para análisis en profundidad.</li>
                </ul>

                <h4>Filtros</h4>
                <p>Puede personalizar la visualización de datos mediante los filtros disponibles en el panel lateral:</p>
                <ul>
                    <li>Seleccione un año específico para ver los datos históricos.</li>
                    <li>Filtre por centro de salud específico o visualice todos.</li>
                    <li>Aplique filtros por sexo y grupo etario.</li>
                    <li>Utilice el control deslizante para filtrar rangos de edad específicos.</li>
                </ul>

                <h4>Exportación</h4>
                <p>Para exportar datos o gráficos:</p>
                <ul>
                    <li>Utilice el botón "Exportar" en la barra superior para exportar el tablero completo.</li>
                    <li>Cada gráfico tiene su propio botón de exportación para guardar solo ese elemento.</li>
                    <li>Los datos se pueden exportar en formatos Excel, PDF o CSV.</li>
                </ul>

                <h4>Informes Predefinidos</h4>
                <p>El sistema ofrece informes predefinidos para análisis comunes:</p>
                <ul>
                    <li>Seleccione un informe de la lista desplegable en el panel lateral.</li>
                    <li>Haga clic en "Generar Informe" para crear automáticamente el análisis seleccionado.</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-primary" id="closeHelpBtn">Entendido</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text">Cargando datos...</div>
    </div>

    <!-- Tooltip Container -->
    <div class="tooltip" id="tooltip"></div>

    <!-- Notification Container -->
    <div class="notification" id="notification">
        <div class="notification-icon"><i class="fas fa-check-circle"></i></div>
        <div class="notification-message">Operación completada con éxito</div>
    </div>

    <script>
        // Datos poblacionales
        const poblacionData = {
            centros: {
                central: {
                    nombre: "CESFAM Curicó Centro",
                    total: 41532,
                    sexo: {
                        masculino: 18111,
                        femenino: 23421
                    },
                    edades: {
                        "0-9": 3878,
                        "10-19": 5444,
                        "20-64": 25601,
                        "65+": 6609
                    },
                    detalleEdades: {
                        "0-4": 1518,
                        "5-9": 2360,
                        "10-14": 2671,
                        "15-19": 2773,
                        "20-44": 14678,
                        "45-64": 10923,
                        "65-79": 5071,
                        "80+": 1538
                    },
                    geolocalizacion: {
                        lat: -34.976,
                        lng: -71.236,
                        radio: 2.5
                    }
                },
                maal: {
                    nombre: "CESFAM Miguel Ángel Arenas López",
                    total: 28763,
                    sexo: {
                        masculino: 14094,
                        femenino: 14669
                    },
                    edades: {
                        "0-9": 3199,
                        "10-19": 3687,
                        "20-64": 18218,
                        "65+": 3659
                    },
                    detalleEdades: {
                        "0-4": 1466,
                        "5-9": 1733,
                        "10-14": 1941,
                        "15-19": 1746,
                        "20-44": 10846,
                        "45-64": 7372,
                        "65-79": 2955,
                        "80+": 704
                    },
                    geolocalizacion: {
                        lat: -34.9825,
                        lng: -71.2511,
                        radio: 1.8
                    }
                },
                bma: {
                    nombre: "CESFAM Betty Muñoz Arce",
                    total: 28461,
                    sexo: {
                        masculino: 12604,
                        femenino: 15857
                    },
                    edades: {
                        "0-9": 3782,
                        "10-19": 4039,
                        "20-64": 16868,
                        "65+": 3772
                    },
                    detalleEdades: {
                        "0-4": 1664,
                        "5-9": 2118,
                        "10-14": 2148,
                        "15-19": 1891,
                        "20-44": 10166,
                        "45-64": 6702,
                        "65-79": 2934,
                        "80+": 838
                    },
                    geolocalizacion: {
                        lat: -34.9688,
                        lng: -71.2169,
                        radio: 1.9
                    }
                },
                colon: {
                    nombre: "CESFAM Colón",
                    total: 23785,
                    sexo: {
                        masculino: 11115,
                        femenino: 12670
                    },
                    edades: {
                        "0-9": 2858,
                        "10-19": 3281,
                        "20-64": 14315,
                        "65+": 3331
                    },
                    detalleEdades: {
                        "0-4": 1192,
                        "5-9": 1666,
                        "10-14": 1702,
                        "15-19": 1579,
                        "20-44": 8648,
                        "45-64": 5667,
                        "65-79": 2659,
                        "80+": 672
                    },
                    geolocalizacion: {
                        lat: -34.9923,
                        lng: -71.2229,
                        radio: 1.7
                    }
                },
                sarmiento: {
                    nombre: "CESFAM Sarmiento",
                    total: 13722,
                    sexo: {
                        masculino: 6792,
                        femenino: 6930
                    },
                    edades: {
                        "0-9": 1469,
                        "10-19": 2078,
                        "20-64": 8583,
                        "65+": 1592
                    },
                    detalleEdades: {
                        "0-4": 599,
                        "5-9": 870,
                        "10-14": 1016,
                        "15-19": 1062,
                        "20-44": 5107,
                        "45-64": 3476,
                        "65-79": 1272,
                        "80+": 320
                    },
                    geolocalizacion: {
                        lat: -35.0177,
                        lng: -71.2608,
                        radio: 1.5
                    }
                },
                niches: {
                    nombre: "CESFAM Los Niches",
                    total: 13850,
                    sexo: {
                        masculino: 7013,
                        femenino: 6837
                    },
                    edades: {
                        "0-9": 1393,
                        "10-19": 1839,
                        "20-64": 8484,
                        "65+": 2134
                    },
                    detalleEdades: {
                        "0-4": 589,
                        "5-9": 804,
                        "10-14": 934,
                        "15-19": 905,
                        "20-44": 4797,
                        "45-64": 3687,
                        "65-79": 1674,
                        "80+": 460
                    },
                    geolocalizacion: {
                        lat: -35.0114,
                        lng: -71.1857,
                        radio: 1.3
                    }
                }
            },
            comuna: {
                nombre: "Curicó",
                total: 150113,
                sexo: {
                    masculino: 69729,
                    femenino: 80384
                },
                edades: {
                    "0-9": 16579,
                    "10-19": 20368,
                    "20-64": 92069,
                    "65+": 21097
                },
                detalleEdades: {
                    "0-4": 7028,
                    "5-9": 9551,
                    "10-14": 10412,
                    "15-19": 9956,
                    "20-44": 54242,
                    "45-64": 37827,
                    "65-79": 16565,
                    "80+": 4532
                },
                geolocalizacion: {
                    lat: -34.9828,
                    lng: -71.2394,
                    radio: 5.0
                }
            },
            // Datos de pirámide poblacional por años individuales
            piramide: {
                // Los datos extraídos del archivo
                grupos: [
                    "0", "1", "2", "3", "4", "5", "6", "7", "8", "9",
                    "10", "11", "12", "13", "14", "15", "16", "17", "18", "19",
                    "20", "21", "22", "23", "24", "25", "26", "27", "28", "29",
                    "30", "31", "32", "33", "34", "35", "36", "37", "38", "39",
                    "40", "41", "42", "43", "44", "45", "46", "47", "48", "49",
                    "50", "51", "52", "53", "54", "55", "56", "57", "58", "59",
                    "60", "61", "62", "63", "64", "65", "66", "67", "68", "69",
                    "70", "71", "72", "73", "74", "75", "76", "77", "78", "79",
                    "80", "81", "82", "83", "84", "85", "86", "87", "88", "89",
                    "90", "91", "92", "93", "94", "95", "96", "97", "98", "99+"
                ],
                masculino: [
                    481, 669, 769, 730, 855, 973, 970, 886, 1002, 1025,
                    1120, 1019, 1008, 1073, 1042, 1032, 1071, 965, 977, 991,
                    919, 920, 955, 950, 952, 960, 964, 1028, 1018, 1071,
                    1113, 1049, 1105, 1047, 1158, 1046, 1155, 947, 941, 880,
                    845, 878, 915, 862, 860, 800, 884, 853, 903, 915,
                    912, 907, 851, 814, 735, 853, 910, 905, 917, 886,
                    881, 928, 863, 817, 753, 695, 687, 685, 622, 618,
                    524, 537, 497, 468, 439, 403, 357, 346, 296, 267,
                    254, 208, 202, 187, 172, 147, 115, 75, 86, 61,
                    51, 34, 48, 31, 17, 13, 8, 8, 3, 69
                ],
                femenino: [
                    476, 648, 737, 797, 866, 927, 880, 886, 969, 1033,
                    1052, 1006, 1001, 1020, 1071, 1082, 1026, 1018, 919, 875,
                    958, 961, 975, 1013, 1016, 1062, 1096, 1187, 1216, 1229,
                    1376, 1345, 1309, 1406, 1398, 1451, 1423, 1263, 1226, 1132,
                    1096, 1123, 1182, 1163, 1098, 1051, 976, 1011, 1075, 1092,
                    1158, 1062, 1021, 924, 896, 1033, 1102, 1102, 993, 1105,
                    1007, 1032, 1041, 979, 880, 814, 821, 840, 732, 700,
                    635, 681, 586, 554, 555, 520, 480, 433, 389, 384,
                    361, 285, 261, 265, 246, 212, 167, 157, 134, 125,
                    100, 74, 67, 52, 53, 57, 34, 17, 14, 33
                ]
            },
            // Datos INE estimados para comparativa
            datosINE: {
                total: 158790,
                sexo: {
                    masculino: 76950,
                    femenino: 81840
                },
                edades: {
                    "0-9": 18250,
                    "10-19": 19520,
                    "20-64": 96850,
                    "65+": 24170
                }
            },
            // Tendencia histórica (para gráfico de tendencias)
            tendencia: {
                años: ["2020", "2021", "2022", "2023", "2024"],
                población: [141250, 143860, 145925, 148230, 150113],
                porSexo: {
                    masculino: [65840, 66975, 67892, 68912, 69729],
                    femenino: [75410, 76885, 78033, 79318, 80384]
                },
                porEdad: {
                    "0-9": [16890, 16750, 16620, 16610, 16579],
                    "10-19": [19850, 19960, 20150, 20280, 20368],
                    "20-64": [86350, 87950, 89180, 90850, 92069],
                    "65+": [18160, 19200, 19975, 20490, 21097]
                }
            }
        };

        // Configuración de colores
        const colores = {
            centros: [
                'rgba(26, 115, 232, 0.8)',
                'rgba(66, 133, 244, 0.8)',
                'rgba(52, 168, 83, 0.8)',
                'rgba(251, 188, 4, 0.8)',
                'rgba(234, 67, 53, 0.8)',
                'rgba(103, 58, 183, 0.8)'
            ],
            edades: {
                "0-9": 'rgba(52, 168, 83, 0.8)',
                "10-19": 'rgba(66, 133, 244, 0.8)',
                "20-64": 'rgba(251, 188, 4, 0.8)',
                "65+": 'rgba(234, 67, 53, 0.8)'
            },
            sexo: {
                masculino: 'rgba(66, 133, 244, 0.8)',
                femenino: 'rgba(234, 67, 53, 0.8)'
            },
            comparativa: {
                inscrita: 'rgba(52, 168, 83, 0.8)',
                ine: 'rgba(103, 58, 183, 0.8)'
            }
        };

        // DOM Elements
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar elementos de UI
            initUI();
            
            // Iniciar carga de datos
            showLoading();
            
            // Simular carga de datos (en una implementación real, aquí iría la carga desde la base de datos)
            setTimeout(() => {
                // Inicializar gráficos
                initCharts();
                
                // Actualizar estadísticas
                updateStats();
                
                // Ocultar carga
                hideLoading();
                
                // Mostrar notificación de datos cargados
                showNotification('Datos cargados correctamente', 'success');
            }, 1000);
        });

        // Inicialización de UI
        function initUI() {
            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(this.dataset.tab + '-tab').classList.add('active');
                });
            });

            // Modal Export
            document.getElementById('exportBtn').addEventListener('click', function() {
                document.getElementById('exportModal').classList.add('active');
            });

            document.getElementById('closeExportModal').addEventListener('click', function() {
                document.getElementById('exportModal').classList.remove('active');
            });

            document.getElementById('cancelExport').addEventListener('click', function() {
                document.getElementById('exportModal').classList.remove('active');
            });

            document.getElementById('confirmExport').addEventListener('click', function() {
                // Simular exportación
                showLoading();
                setTimeout(() => {
                    hideLoading();
                    document.getElementById('exportModal').classList.remove('active');
                    showNotification('Datos exportados correctamente', 'success');
                }, 1500);
            });

            // Help Modal
            document.getElementById('helpBtn').addEventListener('click', function() {
                document.getElementById('helpModal').classList.add('active');
            });

            document.getElementById('closeHelpModal').addEventListener('click', function() {
                document.getElementById('helpModal').classList.remove('active');
            });

            document.getElementById('closeHelpBtn').addEventListener('click', function() {
                document.getElementById('helpModal').classList.remove('active');
            });

            // Print
            document.getElementById('printBtn').addEventListener('click', function() {
                window.print();
            });

            // Filters
            document.getElementById('applyFilters').addEventListener('click', function() {
                showLoading();
                setTimeout(() => {
                    updateCharts();
                    updateStats();
                    hideLoading();
                    showNotification('Filtros aplicados correctamente', 'success');
                }, 800);
            });

            document.getElementById('resetFilters').addEventListener('click', function() {
                // Reset all filters to default
                document.getElementById('yearFilter').value = '2024';
                document.getElementById('communeFilter').value = 'curico';
                document.getElementById('centerFilter').value = 'all';
                document.getElementById('maleFilter').checked = true;
                document.getElementById('femaleFilter').checked = true;
                document.getElementById('infantilFilter').checked = true;
                document.getElementById('adolescenteFilter').checked = true;
                document.getElementById('adultoFilter').checked = true;
                document.getElementById('adultoMayorFilter').checked = true;
                document.getElementById('ageRangeMin').value = 0;
                document.getElementById('ageRangeMax').value = 99;
                document.getElementById('ageRangeMinValue').textContent = 0;
                document.getElementById('ageRangeMaxValue').textContent = 99;
                
                // Apply reset filters
                showLoading();
                setTimeout(() => {
                    updateCharts();
                    updateStats();
                    hideLoading();
                    showNotification('Filtros restablecidos', 'info');
                }, 800);
            });

            // Range slider values
            document.getElementById('ageRangeMin').addEventListener('input', function() {
                document.getElementById('ageRangeMinValue').textContent = this.value;
            });

            document.getElementById('ageRangeMax').addEventListener('input', function() {
                document.getElementById('ageRangeMaxValue').textContent = this.value;
            });

            // Generate report
            document.getElementById('generateReport').addEventListener('click', function() {
                const reportType = document.getElementById('reportTemplate').value;
                if (!reportType) {
                    showNotification('Por favor seleccione un tipo de informe', 'warning');
                    return;
                }
                
                showLoading();
                setTimeout(() => {
                    hideLoading();
                    showNotification('Informe generado correctamente', 'success');
                    
                    // En una implementación real, aquí se generaría el informe específico
                    // Por ahora solo cambiamos a la pestaña más relevante según el informe
                    switch(reportType) {
                        case 'report_distribution':
                            document.querySelector('[data-tab="overview"]').click();
                            break;
                        case 'report_age_gender':
                            document.querySelector('[data-tab="demographics"]').click();
                            break;
                        case 'report_comparison':
                            document.querySelector('[data-tab="comparison"]').click();
                            break;
                        case 'report_geo':
                            document.querySelector('[data-tab="geographical"]').click();
                            break;
                        case 'report_trends':
                            document.querySelector('[data-tab="overview"]').click();
                            break;
                        case 'report_full':
                            document.querySelector('[data-tab="overview"]').click();
                            break;
                    }
                }, 1200);
            });
        }

        // Inicialización de gráficos
        function initCharts() {
            // Gráfico de distribución por centro de salud
            const distributionCtx = document.getElementById('distributionChart').getContext('2d');
            const distributionData = {
                labels: Object.values(poblacionData.centros).map(centro => centro.nombre),
                datasets: [{
                    label: 'Población',
                    data: Object.values(poblacionData.centros).map(centro => centro.total),
                    backgroundColor: colores.centros,
                    borderWidth: 1
                }]
            };
            
            const distributionChart = new Chart(distributionCtx, {
                type: 'pie',
                data: distributionData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: ${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Gráfico de pirámide poblacional
            const pyramidCtx = document.getElementById('pyramidChart').getContext('2d');
            
            // Agrupar datos de pirámide para mejor visualización
            const pyramidLabels = [];
            const pyramidMale = [];
            const pyramidFemale = [];
            
            // Agrupar por rangos de 5 años
            for (let i = 0; i < poblacionData.piramide.grupos.length; i += 5) {
                const rangoEdad = i === 95 ? `${i}+` : `${i}-${i+4}`;
                pyramidLabels.push(rangoEdad);
                
                let sumaMale = 0;
                let sumaFemale = 0;
                
                for (let j = 0; j < 5 && (i + j) < poblacionData.piramide.grupos.length; j++) {
                    sumaMale += poblacionData.piramide.masculino[i + j];
                    sumaFemale += poblacionData.piramide.femenino[i + j];
                }
                
                pyramidMale.push(-sumaMale); // Valores negativos para visualización
                pyramidFemale.push(sumaFemale);
            }
            
            const pyramidData = {
                labels: pyramidLabels,
                datasets